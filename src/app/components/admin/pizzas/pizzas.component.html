<div class="container">
    <h3>Pizzák kezelése</h3>


    <button class="btn btn-primary my-3" data-bs-toggle="modal" data-bs-target="#formModal"><i class="bi bi-plus-circle-fill"></i>  Új pizza hozzáadása</button>

    <table class="table table-hover table-stripped">
        <thead>
            <tr>
                <th>#</th>
                <th>Kép</th>
                <th>Megnevezés</th>
                <th>Leírás</th>
                <th class="text-end">Kalória</th>
                <th class="text-end">Ár</th>
                <th class="text-end">Műveletek</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let pizza of pagedPizza; let i = index">
                <td>{{i+1}}.</td>
                <td>
                  <img *ngIf="pizza.image" src="http://localhost:3000/uploads/{{pizza.image}}" alt="{{pizza.name}}" 
                  class="thumbnail" (click)="openLightBox(pizza.image)">
                  {{pizza.image}}</td>
                <td>{{pizza.name}}</td>
                <td>{{pizza.descrip}}</td>
                <td class="text-end">{{pizza.calories |numberFormat }} kcal</td>
                <td class="text-end">{{pizza.price |numberFormat}} {{currency}}</td>
                <td class="text-end">
                    <button class="btn btn-warning me-3" (click)="getPizza(pizza.id)" data-bs-toggle="modal" data-bs-target="#formModal"><i class="bi bi-pencil-square"></i></button>
                    <button class="btn btn-danger me-3"  (click)="confirmDelete(pizza.id)" data-bs-toggle="modal" data-bs-target="#confirmModal"><i class="bi bi-x-square-fill"></i></button>
                </td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="7">Összesen: <strong>0</strong> rendelés</td>
            </tr>
        </tfoot>
    </table>
    <nav aria-label="Page navigation example" *ngIf="totalPages > 1">
        <ul class="pagination">
          <li class="page-item">
            <a class="page-link"  aria-label="Previous" (click)="setPage(currentPage-1)" [class.disabled]="currentPage == 1">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>

            <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index">
              <a class="page-link" (click)="setPage(i + 1)"  [class.active]="currentPage == i + 1">{{i + 1}}</a>
            </li>

          <li class="page-item">
            <a class="page-link"  aria-label="Next" (click)="setPage(currentPage+1)" [class.disabled]="currentPage == totalPages">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
        </ul>
      </nav>


  
  <!-- Form Modal -->
  <div class="modal fade" id="formModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="formModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="formModalLabel" *ngIf="!editmode">Új pizza hozzáadása</h1>
          <h1 class="modal-title fs-5" id="formModalLabel" *ngIf="editmode">Pizza módosítása</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          
          <div class="form-floating mb-3">
            <input type="text" class="form-control" id="pizzaNameForm" placeholder="name@example.com" [(ngModel)] = "pizza.name">
            <label for="pizzaNameForm">Pizza neve</label>
          </div>
          <div class="form-floating mb-3">
            <input type="number" class="form-control" id="pizzaCalForm" placeholder="name@example.com" [(ngModel)] = "pizza.calories">
            <label for="pizzaCalForm">Kalória</label>
          </div>
          <div class="form-floating mb-3">
            <input type="number" class="form-control" id="pizzaCostForm" placeholder="name@example.com" [(ngModel)] = "pizza.price">
            <label for="pizzaCostForm">Ár</label>
          </div>
          <div class="mb-3">
            <label for="formFile" class="form-label">Példa kép</label>
            <input class="form-control" type="file" id="formFile" accept="image/*" (change)="onFileSelected($event)">
          </div>
          <div class="form-floating mb-3">
            <input  class="form-control textarea" id="pizzaDescrForm" placeholder="name@example.com" [(ngModel)] = "pizza.descrip">
            <label for="pizzaDescrForm">Pizza leírása</label>
          </div>


        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Mégsem</button>
          <button type="button" class="btn btn-success" (click)="saveP()">Megerősítés</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Confirm Modal -->
  <div class="modal fade" id="confirmModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Megerősítés</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Biztos vagy te ebbe öcsi?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hupika</button>
          <button type="button" class="btn btn-danger" (click)="deleteP(pizza.id)">Igen</button>
        </div>
      </div>
    </div>
  </div>
</div>

<app-lightbox [imageUrl]="lightBoxUrl" [visible]="lightBoxVisible" (closed)="lightBoxVisible=false"></app-lightbox>